<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The UP Dawg</title>
    <link rel="stylesheet" href="{{url_for('static',filename='dist/css/output.css')}}">
</head>
<body>
    <header class="flex flex-row bg-gray-600 h-16 w-full">
        <div class="w-3/4 flex flex-grow align-center text-center items-center justify-center">
            <div class="flex">
                <h1>The UP Da<a href="{{ url_for('gen_news')}}" class="gen_w">w</a>g</h1>
                <p>Simple & Unbiased since 2005</p>
            </div>
            <div class="flex">
                <a href="{{ url_for('about') }}">About</a>
            </div>
            <div class="flex">
                <a href="https://www.scientologynews.org/quick-facts/community-outreach-actions.html">Donate</a>
            </div>
        </div>
    </header>
    <!-- <main class="article-container">
        <section class="articles">
            {% for story in stories %}
            <article>
                <div class="content">
                    <h2><a href="{{ url_for('story', uuid=story.uuid)}}">{{ story.title }}</a></h2>
                    {% if story.days == "0" %}
                        <p class="meta">by {{ story.author }} | Posted today</p>
                    {% elif story.days == "1" %}
                        <p class="meta">by {{ story.author }} | Posted yesterday</p>
                    {% else %}
                        <p class="meta">by {{ story.author }} | Posted {{ story.days }} days ago</p>
                    {% endif %}
                    <p>{{ story.short }}</p>
                    <a class="read-more" href="{{ url_for('story', uuid=story.uuid)}}">Read More</a>
                </div>
            </article>
            {% endfor %}
        </section>
    </main>
    <footer>
        <p>&copy; 2024 The UP Dawg. All rights reserved.</p>
    </footer> -->
</body>
</html>


            <small>By {{ comment.user_id }} at {{ comment.created }}</small>

{% macro render_comment(comment, comment_tree, forms) %}
    <div class="comment">
        <div class="bg-gray-800 flex flex-row m-3">
            <p class="pl-2 pt-1">{{ comment.content }}</p>
            <button class="relative ml-auto px-3 py-2 reply-btn" data-comment-id="{{ comment.id }}">Reply</button> 
        </div> 
        
        <div class="reply-form-container hidden" data-comment-id="{{ comment.id }}">
            <form method="POST" class="reply-form" data-comment-id="{{ comment.id }}" data-uuid="{{ uuid }}">
                {{ forms[comment.id].hidden_tag() }}
                {{ forms[comment.id].comment}}
                {{ forms[comment.id].submit }}
            </form>    
        </div>

        <div class="replies ml-10">
            {% for child in comment_tree[comment.id] %}
                {{ render_comment(child, comment_tree, forms) }}
            {% endfor %}
        </div>
    </div>
{% endmacro %}
    {% for comment in top_level_comments %}
        {{ render_comment(comment, comment_tree, forms) }}
{% endfor %}

    $(document).ready(function() {
        $(document).on('click', '.reply-btn', function() {
            const commentId = $(this).data('comment-id')
            const uuid = $(this).data('uuid')

            $(`.reply-form-container[data-comment-id="${commentId}"]`).toggle('hidden');
        })

        $(document).on('submit', '.reply-form', function(event) {
            event.preventDefault()

            const commentId = $(this).data('comment-id')
            const uuid = $(this).data('uuid')
            
            const data = {
                comment_id: commentId,
                uuid: uuid,
                content: this.comment.value
            };

            fetch(`{{ url_for('main.reply') }}`, {
                method: 'POST',
                body: JSON.stringify(data), //Send as JSON string
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json()).then(data => {
                console.log(data)
            }).catch((error) => {
                console.error(error)
            })
        })
    })